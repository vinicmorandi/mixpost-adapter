import{O as W,H as B,r as q,o as n,k as $,w as e,a as t,A as Z,e as g,c as v,t as o,f as _,b as s,ae as G,h as r,F as D,a2 as I,E as K,j as z,a8 as Q,a7 as X,a3 as Y,i as E,S as ee,a0 as te,c5 as P,a5 as se,a6 as S,l as j,ac as T,cd as ae,n as le,Z as oe,au as R,m as ie,J as ne}from"./app.a05b4c5c.js";import{u as re}from"./useSelectable.08fa8b7e.js";import{_ as ue}from"./PageHeader.044c6731.js";import{_ as N,a as ce}from"./PostsFilter.5e61cfd7.js";import{T as de,_ as V}from"./Tab.af6a2b17.js";import{_ as me}from"./Panel.05e9bba5.js";import{_ as A}from"./Checkbox.12b1be22.js";import{_ as d,a as H,T as fe}from"./TableCell.8aafd44e.js";import{_ as pe}from"./PureDangerButton.9adab555.js";import{u as ve}from"./usePostVersions.2acb12a0.js";import{_ as _e}from"./MediaFile.a2421f6b.js";import{_ as F,c as he,b as ke,a as ge}from"./VerticallyScrollableContent.528227ae.js";import{_ as $e}from"./PureButton.7cf07808.js";import{_ as U}from"./Account.894edbec.js";import{_ as be}from"./SelectableBar.c8863131.js";import{_ as xe}from"./Pagination.cc249589.js";import{_ as we}from"./NoResult.b8d4ef7e.js";import{T as ye}from"./Trash.83ab4124.js";import"./Flex.513e8e8d.js";import"./PureButtonLink.21473f96.js";import"./EllipsisVertical.0bda3946.js";import"./ProviderIcon.9a25a410.js";import"./SearchInput.296daeed.js";import"./Input.44809a08.js";import"./ExclamationCircle.df2493b4.js";import"./Variable.40ae6e15.js";import"./index.a09b91eb.js";import"./EditorReadOnly.903d5559.js";import"./Alert.49de0ead.js";import"./Refresh.62a08e2e.js";import"./ArrowTopRightOnSquare.a67b2cfb.js";import"./ColorPicker.b4d23b31.js";import"./ChevronLeft.727e7cc4.js";const Ce={class:"w-44"},Ve={key:0,class:"text-sm mt-xs text-gray-500"},De={key:1,class:"text-sm mt-xs text-gray-500"},Oe={class:"w-96 text-left break-words"},Ie={key:0,class:"w-48 flex relative"},je={key:0,class:"absolute top-0 -right-5 z-10"},Be={class:"flex flex-wrap gap-xs"},Pe={class:"flex gap-xs"},Se={class:"mr-xs"},Te={class:"text-left"},Re={class:"mr-xs"},Ne={__name:"PostItem",props:{item:{type:Object,required:!0},filter:{type:Object,default:{accounts:[]}}},setup(a){const m=a,{getOriginalVersion:i,getAccountVersion:f}=ve(),p=W(()=>{if(!m.item.versions.length)return{excerpt:"",media:null,media_count:0};let b=m.item.accounts;m.filter.accounts.length&&(b=b.filter(u=>m.filter.accounts.includes(u.id)));const C=b.map(u=>{const h=f(m.item.versions,u.id);return h?h.content[0]:i(m.item.versions).content[0]}),x=C.length?C[0]:m.item.versions[0].content[0];return{excerpt:x.excerpt,media:x.media.length?x.media[0]:null,media_count:x.media.length}}),w=B(!1),y=()=>{w.value=!0},O=()=>{w.value=!1};return(b,C)=>{const x=q("tooltip");return n(),$(H,{hoverable:!0},{default:e(()=>[t(d,{class:"w-10"},{default:e(()=>[Z(b.$slots,"checkbox")]),_:3}),t(d,{clickable:!0,onClick:y},{default:e(()=>[g("div",Ce,[t(F,{value:a.item.status},null,8,["value"]),a.item.status==="scheduled"?(n(),v("div",Ve,o(a.item.scheduled_at.human),1)):_("",!0),a.item.status==="published"?(n(),v("div",De,o(a.item.published_at.human),1)):_("",!0)])]),_:1}),t(d,{clickable:!0,onClick:y,class:"!pl-0"},{default:e(()=>[g("div",Oe,o(s(p).excerpt),1)]),_:1}),t(d,{clickable:!0,onClick:y},{default:e(()=>[s(p).media?(n(),v("div",Ie,[s(p).media?(n(),$(_e,{key:0,media:s(p).media,"img-height":"sm",imgWidthFull:!1},{default:e(()=>[s(p).media_count>1?(n(),v("div",je,[t(G,null,{default:e(()=>[r("+"+o(s(p).media_count-1),1)]),_:1})])):_("",!0)]),_:1},8,["media"])):_("",!0)])):_("",!0)]),_:1}),t(d,{clickable:!0,onClick:y},{default:e(()=>[g("div",Be,[(n(!0),v(D,null,I(a.item.tags,u=>(n(),$(he,{key:u.id,item:u,removable:!1,editable:!1},null,8,["item"]))),128))])]),_:1}),t(d,null,{default:e(()=>[g("div",Pe,[(n(!0),v(D,null,I(a.item.accounts.slice(0,3),(u,h)=>(n(),v("div",{key:u.id,class:K({"-ml-6":h>0})},[z(t(U,{provider:u.provider,name:u.name,"img-url":u.image,active:!0},null,8,["provider","name","img-url"]),[[x,u.name]])],2))),128)),a.item.accounts.length>3?(n(),$(Q,{key:0,"width-classes":"w-64",placement:"bottom-end"},{trigger:e(()=>[t($e,{class:"mt-4 font-semibold"},{default:e(()=>[r("+"+o(a.item.accounts.slice(3).length),1)]),_:1})]),content:e(()=>[t(ke,null,{default:e(()=>[(n(!0),v(D,null,I(a.item.accounts.slice(3),u=>(n(),$(X,{as:"div"},{default:e(()=>[g("span",Se,[t(U,{provider:u.provider,name:u.name,"img-url":u.image,active:!0},null,8,["provider","name","img-url"])]),g("span",Te,o(u.name),1)]),_:2},1024))),256))]),_:1})]),_:1})):_("",!0)])]),_:1}),t(d,null,{default:e(()=>[r(o(a.item.user.name),1)]),_:1}),t(d,null,{default:e(()=>[t(N,{itemId:a.item.id,trashed:a.item.trashed},null,8,["itemId","trashed"])]),_:1}),t(Y,{show:w.value,scrollableBody:!0,onClose:O},{body:e(()=>[t(F,{value:a.item.status,class:"mb-lg"},null,8,["value"]),w.value?(n(),$(ge,{key:0,accounts:a.item.accounts,versions:a.item.versions},null,8,["accounts","versions"])):_("",!0)]),footer:e(()=>[w.value?(n(),v(D,{key:0},[g("div",Re,[t(N,{itemId:a.item.id,trashed:a.item.trashed},null,8,["itemId","trashed"])]),t(E,{onClick:O},{default:e(()=>[r(o(b.$t("general.close")),1)]),_:1})],64)):_("",!0)]),_:1},8,["show"])]),_:3})}}},Ae={class:"row-py mb-2xl"},Fe={class:"w-full row-px"},Ue={class:"w-full row-px mt-lg"},qe={key:0,class:"mt-lg"},$t={__name:"Index",props:{filter:{type:Object,default:{}},posts:{type:Object},has_failed_posts:{type:Boolean,default:!1}},setup(a){const m=a,{t:i}=ee(),f=B({keyword:m.filter.keyword,status:m.filter.status,tags:m.filter.tags,accounts:m.filter.accounts}),{selectedRecords:p,putPageRecords:w,toggleSelectRecordsOnPage:y,deselectRecord:O,deselectAllRecords:b}=re(),C=le("workspaceCtx"),x=()=>m.posts.data.map(k=>k.id);te(()=>{w(x()),P.on("postDelete",k=>{O(k)})}),se(()=>{P.off("postDelete")}),S(()=>j.exports.cloneDeep(f.value),j.exports.throttle(()=>{T.get(route("mixpost.posts.index",{workspace:C.id}),j.exports.pickBy(f.value),{preserveState:!0,only:["posts","filter"]})},300)),S(()=>m.posts.data,()=>{w(x())});const{notify:u}=ne(),h=B(!1),J=()=>{T.delete(route("mixpost.posts.multipleDelete",{workspace:C.id}),{data:{posts:p.value,status:f.value.status},onSuccess(){b(),u("success",m.filter.status==="trash"?i("post.posts_deleted"):i("post.posts_to_trash"))},onFinish(){h.value=!1}})};return(k,l)=>{const L=q("tooltip");return n(),v(D,null,[t(s(oe),{title:s(i)("post.posts")},null,8,["title"]),g("div",Ae,[t(ue,{title:s(i)("post.posts")},{default:e(()=>[t(ce,{modelValue:f.value,"onUpdate:modelValue":l[0]||(l[0]=c=>f.value=c),class:"md:ml-2"},null,8,["modelValue"])]),_:1},8,["title"]),g("div",Fe,[t(de,null,{default:e(()=>[t(V,{onClick:l[1]||(l[1]=c=>f.value.status=null),active:!k.$page.props.filter.status},{default:e(()=>[r("All")]),_:1},8,["active"]),t(V,{onClick:l[2]||(l[2]=c=>f.value.status="draft"),active:k.$page.props.filter.status==="draft"},{default:e(()=>[r(o(s(i)("post.drafts")),1)]),_:1},8,["active"]),t(V,{onClick:l[3]||(l[3]=c=>f.value.status="scheduled"),active:k.$page.props.filter.status==="scheduled"},{default:e(()=>[r(o(s(i)("post.scheduled")),1)]),_:1},8,["active"]),t(V,{onClick:l[4]||(l[4]=c=>f.value.status="published"),active:k.$page.props.filter.status==="published"},{default:e(()=>[r(o(s(i)("post.published")),1)]),_:1},8,["active"]),a.has_failed_posts?(n(),$(V,{key:0,onClick:l[5]||(l[5]=c=>f.value.status="failed"),active:k.$page.props.filter.status==="failed",class:"text-red-500"},{default:e(()=>[r(o(s(i)("post.failed")),1)]),_:1},8,["active"])):_("",!0),t(V,{onClick:l[6]||(l[6]=c=>f.value.status="trash"),active:k.$page.props.filter.status==="trash"},{default:e(()=>[r(o(s(i)("general.trash")),1)]),_:1},8,["active"])]),_:1})]),g("div",Ue,[t(be,{count:s(p).length,onClose:s(b)},{default:e(()=>[z((n(),$(pe,{onClick:l[7]||(l[7]=c=>h.value=!0)},{default:e(()=>[t(ye)]),_:1})),[[L,s(i)("general.delete")]])]),_:1},8,["count","onClose"]),t(me,{"with-padding":!1},{default:e(()=>[t(fe,null,{head:e(()=>[t(H,null,{default:e(()=>[t(d,{component:"th",scope:"col",class:"w-10"},{default:e(()=>[t(A,{checked:s(y),"onUpdate:checked":l[8]||(l[8]=c=>R(y)?y.value=c:null),disabled:!a.posts.meta.total},null,8,["checked","disabled"])]),_:1}),t(d,{component:"th",scope:"col",class:"w-44"},{default:e(()=>[r(o(s(i)("post.status")),1)]),_:1}),t(d,{component:"th",scope:"col",class:"!pl-0 text-left"},{default:e(()=>[r(o(s(i)("post.content")),1)]),_:1}),t(d,{component:"th",scope:"col",class:"w-48"},{default:e(()=>[r(o(s(i)("post.media")),1)]),_:1}),t(d,{component:"th",scope:"col"},{default:e(()=>[r(o(s(i)("post.labels")),1)]),_:1}),t(d,{component:"th",scope:"col"},{default:e(()=>[r(o(s(i)("post.accounts")),1)]),_:1}),t(d,{component:"th",scope:"col"},{default:e(()=>[r(o(s(i)("post.author")),1)]),_:1}),t(d,{component:"th",scope:"col"})]),_:1})]),body:e(()=>[(n(!0),v(D,null,I(a.posts.data,c=>(n(),$(Ne,{key:c.id,item:c,filter:a.posts.filter,onOnDelete:()=>{s(O)(c.id)}},{checkbox:e(()=>[t(A,{checked:s(p),"onUpdate:checked":l[9]||(l[9]=M=>R(p)?p.value=M:null),value:c.id},null,8,["checked","value"])]),_:2},1032,["item","filter","onOnDelete"]))),128))]),_:1}),a.posts.meta.total?_("",!0):(n(),$(we,{key:0,class:"py-md px-md"},{default:e(()=>[r(o(s(i)("post.no_posts_found")),1)]),_:1}))]),_:1}),a.posts.meta.links.length>3?(n(),v("div",qe,[t(xe,{meta:a.posts.meta,links:a.posts.links},null,8,["meta","links"])])):_("",!0)])]),t(ae,{show:h.value,variant:"danger",onClose:l[11]||(l[11]=c=>h.value=!1)},{header:e(()=>[r(o(s(i)("post.delete_posts")),1)]),body:e(()=>[r(o(s(i)("post.confirmation_delete_post")),1)]),footer:e(()=>[t(E,{onClick:l[10]||(l[10]=c=>h.value=!1),class:"mr-xs"},{default:e(()=>[r(o(s(i)("general.cancel")),1)]),_:1}),t(ie,{onClick:J},{default:e(()=>[r(o(s(i)("general.delete")),1)]),_:1})]),_:1},8,["show"])],64)}}};export{$t as default};
