import{H as p,O as U,a6 as Y,l as Z,N as A,ah as ce,J as ue,o as s,c as g,A as Q,e as v,k as V,Q as de,f as u,E as B,n as L,ag as E,g as T,a as i,a9 as me,h as M,t as S,b as e,I as fe,w as o,F as J,p as ee,a0 as W,W as te,au as se,_ as ae,q as le}from"./app.a05b4c5c.js";import{n as pe}from"./index.browser.8e74d592.js";import{_ as G}from"./Masonry.cd3ab109.js";import{_ as q}from"./MediaFile.a2421f6b.js";import{_ as ne}from"./SearchInput.296daeed.js";import{_ as oe}from"./NoResult.b8d4ef7e.js";import{_ as re}from"./Alert.49de0ead.js";const R=(l="mixpost.media.fetchUploads",_={})=>{const{notify:h}=ue(),P=p("uploads"),f=U(()=>["uploads","stock","gifs"]),C=p(!1),n=p(!1),N=p(!1),k=p(1),d=p([]),$=p(null),w=p(""),y=p([]),b=c=>{const r=y.value.findIndex(t=>t.id===c.id);r<0&&!c.hasOwnProperty("error")&&y.value.push(c),r>=0&&y.value.splice(r,1)},O=()=>{y.value=[]},D=c=>y.value.findIndex(t=>t.id===c.id)!==-1,m=(c=!0)=>{!k.value||(A.start(),axios.get(route(l,_),{params:{page:k.value,keyword:w.value}}).then(function(r){const t=r.data.links.next;t&&(k.value=r.data.links.next.split("?page=")[1]),t||(k.value=0),c||(d.value=r.data.data),c&&(d.value=[...d.value,...r.data.data])}).catch(()=>{h("error",$t("media.error_retrieving_media"))}).finally(()=>{A.done(),C.value=!0}))},x=(c,r)=>{n.value=!0,A.start(),axios.post(route("mixpost.media.download",_),{items:c,from:P.value}).then(t=>{r(t)}).catch(()=>{h("error",$t("media.error_downloading_media"))}).finally(()=>{n.value=!1,A.done(),A.remove()})},I=c=>{d.value=d.value.filter(r=>!c.includes(r.id))},F=(c,r)=>{N.value=!0,A.start(),axios.delete(route("mixpost.media.delete",_),{data:{items:c}}).then(()=>{r()}).catch(()=>{h("error",$t("media.error_deleting_media"))}).finally(()=>{N.value=!1,A.done(),A.remove()})},z=()=>{const c=new IntersectionObserver(r=>{r[0].isIntersecting&&m()});ce(()=>{c.observe($.value)})};return Y(w,Z.exports.debounce(()=>{k.value=1,m(!1)},300)),{activeTab:P,tabs:f,isLoaded:C,isDownloading:n,isDeleting:N,keyword:w,page:k,items:d,endlessPagination:$,selected:y,downloadExternal:x,deletePermanently:F,removeItems:I,createObserver:z,toggleSelect:b,deselectAll:O,isSelected:D}},H={__name:"MediaSelectable",props:{active:{type:Boolean,default:!1}},emits:["click"],setup(l){return(_,h)=>(s(),g("div",{onClick:h[0]||(h[0]=P=>_.$emit("click")),class:"w-full relative cursor-pointer box-border"},[Q(_.$slots,"default"),v("div",{class:B(["absolute flex items-center justify-center top-0 right-0 mr-sm mt-sm w-7 h-7 rounded-full border border-white",{"bg-primary-500":l.active,"bg-black bg-opacity-20":!l.active}])},[l.active?(s(),V(de,{key:0,class:"text-white"})):u("",!0)],2)]))}},ve=["onDrop"],ge={class:"relative flex flex-col justify-center"},_e={class:"text-center mb-1"},he={for:"browse",class:"cursor-pointer text-primary-500 hover:text-primary-700 active:text-primary-700 focus:outline-none focus:text-primary-700 transition-colors ease-in-out duration-200"},ke={class:"text-sm text-gray-400 text-center"},ye=["accept"],be={key:0,class:"mt-lg"},xe={__name:"UploadMedia",props:{maxSelection:{type:Number,default:1},combinesMimeTypes:{type:String,default:""},selected:{type:Array,default:[]},toggleSelect:{type:Function},isSelected:{type:Function},columns:{type:Number,default:3}},emits:["mediaSelect"],setup(l,{emit:_}){const h=l,P=L("workspaceCtx"),f=E().props.mixpost.mime_types,C=p(null),n=p(!1),N=t=>{if($.value)return;n.value=!1;const a=d(t.dataTransfer.files);a.length&&z(a)},k=t=>{const a=d(t.target.files);a.length&&(C.value.value=null,z(a))},d=t=>Array.from(t).filter(a=>f.includes(a.type)),$=p(!1),w=p([]),y=p([]),b=p({});Y(b,()=>{O(),$.value=Object.keys(b.value).length>0});const O=()=>{b.value.handler&&b.value.handler()},D=t=>{w.value.push(t),Object.keys(b.value).length===0&&m()},m=t=>{Object.keys(b.value).length>0&&(F(b.value,t),h.toggleSelect&&h.toggleSelect(t)),w.value.length>0?(x(w.value[0]),I()):x({})},x=t=>{b.value=t},I=()=>{w.value.shift()},F=(t,a)=>{y.value.push(Object.assign(t,{media:a}))},z=t=>{t.forEach(a=>{D({id:pe(),handler:async()=>{await c(a).then(j=>{m(j)}).catch(j=>{m({name:a.name,error:j.response.data.message})})}})})},c=t=>{const a=new FormData;return a.append("file",t),new Promise((j,X)=>{axios.post(route("mixpost.media.upload",{workspace:P.id}),a).then(function(K){j(K.data)}).catch(function(K){X(K)})})},r=U(()=>y.value.filter(()=>!0).reverse());return p([]),(t,a)=>(s(),g(J,null,[v("div",{onDragenter:a[2]||(a[2]=T(j=>n.value=!$.value,["prevent"])),onDrop:T(N,["prevent"]),onDragover:a[3]||(a[3]=T(()=>{},["prevent"])),class:B([{"border-gray-700 bg-white":!n.value,"border-cyan-500 bg-cyan-50":n.value},"relative w-full flex items-center justify-center rounded-lg p-10 border-2 border-dashed transition-colors ease-in-out duration-200"])},[v("div",ge,[n.value?(s(),g("div",{key:0,onDragleave:a[0]||(a[0]=T(j=>n.value=!1,["prevent"])),onDragover:a[1]||(a[1]=T(()=>{},["prevent"])),class:"w-full h-full absolute"},null,32)):u("",!0),i(me,{class:B([{"text-stone-700":!n.value,"text-cyan-500":n.value},"!w-16 !h-16 mx-auto mb-xs transition-colors ease-in-out duration-200"])},null,8,["class"]),v("div",_e,[M(S(t.$t("media.drag_drop_files"))+" ",1),v("label",he,S(t.$t("general.browse")),1)]),v("div",ke,S(e(f).join(", ")),1)]),$.value?(s(),V(fe,{key:0,size:"xl",class:"rounded-lg"})):u("",!0)],42,ve),v("input",{ref_key:"input",ref:C,id:"browse",type:"file",accept:e(f).join(","),multiple:"multiple",class:"hidden",onChange:k},null,40,ye),e(r).length?(s(),g("div",be,[i(G,{items:e(r),columns:l.columns},{default:o(({item:j})=>[i(H,{active:l.isSelected(j.media),onClick:X=>l.toggleSelect(j.media)},{default:o(()=>[i(q,{media:j.media},null,8,["media"])]),_:2},1032,["active","onClick"])]),_:1},8,["items","columns"])])):u("",!0)],64))}},$e={},we={class:"w-full text-lg"};function Se(l,_){return s(),g("div",we,[Q(l.$slots,"default")])}const Ce=ee($e,[["render",Se]]),Ge={__name:"MediaUploads",props:{columns:{type:Number,default:3}},setup(l,{expose:_}){const h=L("workspaceCtx"),{page:P,items:f,endlessPagination:C,selected:n,toggleSelect:N,deselectAll:k,removeItems:d,isSelected:$,createObserver:w}=R("mixpost.media.fetchUploads",{workspace:h.id});return W(()=>{w()}),_({selected:n,deselectAll:k,removeItems:d}),(y,b)=>(s(),g(J,null,[i(xe,{"max-selection":4,"combines-mime-types":"",selected:e(n),toggleSelect:e(N),isSelected:e($),columns:l.columns},null,8,["selected","toggleSelect","isSelected","columns"]),v("div",{class:B({"mt-lg":e(f).length})},[e(f).length?(s(),g(J,{key:0},[i(Ce,{class:"mb-4"},{default:o(()=>[M(S(y.$t("media.library")),1)]),_:1}),i(G,{items:e(f),columns:l.columns},{default:o(({item:O})=>[O?(s(),V(H,{key:0,active:e($)(O),onClick:D=>e(N)(O)},{default:o(()=>[i(q,{media:O},null,8,["media"])]),_:2},1032,["active","onClick"])):u("",!0)]),_:1},8,["items","columns"])],64)):u("",!0),v("div",{ref_key:"endlessPagination",ref:C,class:"-z-10 w-full"},null,512)],2)],64))}},Ne={},De={class:"absolute z-10 bottom-0 mb-xs left-0 ml-xs hidden group-hover:block shadow-mix"},Ie={class:"bg-white shadow-mix py-xs px-sm text-left rounded-md"};function Oe(l,_){return s(),g("div",De,[v("div",Ie,[Q(l.$slots,"default")])])}const ie=ee(Ne,[["render",Oe]]),je={key:0},Me={key:0,class:"mt-lg"},Pe=["href"],Ve=["href"],qe={__name:"MediaStock",props:{columns:{type:Number,default:3}},setup(l,{expose:_}){const h=L("workspaceCtx"),{user:P}=te(),f=U(()=>Z.exports.snakeCase(E().props.app.name)),C=U(()=>E().props.is_configured_service.unsplash),{isLoaded:n,keyword:N,page:k,items:d,endlessPagination:$,selected:w,toggleSelect:y,deselectAll:b,isSelected:O,createObserver:D}=R("mixpost.media.fetchStock",{workspace:h.id});return W(()=>{C.value&&D()}),_({selected:w,deselectAll:b}),(m,x)=>(s(),g(J,null,[e(C)?(s(),g("div",je,[i(ne,{modelValue:e(N),"onUpdate:modelValue":x[0]||(x[0]=I=>se(N)?N.value=I:null),placeholder:m.$t("service.unsplash.search")},null,8,["modelValue","placeholder"]),e(d).length?(s(),g("div",Me,[i(G,{items:e(d),columns:l.columns},{default:o(({item:I})=>[I?(s(),V(H,{key:0,active:e(O)(I),onClick:F=>e(y)(I)},{default:o(()=>[i(q,{media:I,class:"group"},{default:o(()=>[i(ie,null,{default:o(()=>[v("div",null,[M(S(m.$t("media.image_source"))+": ",1),v("a",{href:`https://unsplash.com/?utm_source=${e(f)}&utm_medium=referral`,target:"_blank",class:"link"},"Unsplash",8,Pe)]),v("div",null,[M(S(m.$t("media.author"))+": ",1),v("a",{href:`${I.credit_url}?utm_source=${e(f)}&utm_medium=referral`,target:"_blank",class:"link"},S(I.name),9,Ve)])]),_:2},1024)]),_:2},1032,["media"])]),_:2},1032,["active","onClick"])):u("",!0)]),_:1},8,["items","columns"])])):u("",!0),e(n)&&!e(d).length?(s(),V(oe,{key:1,class:"mt-lg"},{default:o(()=>[M(S(m.$t("media.no_images_found")),1)]),_:1})):u("",!0),v("div",{ref_key:"endlessPagination",ref:$,class:"-z-10 w-full"},null,512)])):u("",!0),e(C)?u("",!0):(s(),g(J,{key:1},[i(re,{variant:"warning",closeable:!1},{default:o(()=>[M(S(m.$t("service.not_configured_service",{service:"Unsplash"})),1)]),_:1}),e(P).is_admin?(s(),V(e(le),{key:0,href:m.route("mixpost.services.index"),class:"block mt-md"},{default:o(()=>[i(ae,null,{default:o(()=>[M(S(m.$t("media.click_configure")),1)]),_:1})]),_:1},8,["href"])):u("",!0)],64))],64))}},Ae={key:0},Je={key:0,class:"mt-lg"},He={__name:"MediaGifs",props:{columns:{type:Number,default:3}},setup(l,{expose:_}){const h=L("workspaceCtx"),{user:P}=te(),f=U(()=>E().props.is_configured_service.tenor),{isLoaded:C,keyword:n,page:N,items:k,endlessPagination:d,selected:$,toggleSelect:w,deselectAll:y,isSelected:b,createObserver:O}=R("mixpost.media.fetchGifs",{workspace:h.id});return W(()=>{f.value&&O()}),_({selected:$,deselectAll:y}),(D,m)=>(s(),g(J,null,[e(f)?(s(),g("div",Ae,[i(ne,{modelValue:e(n),"onUpdate:modelValue":m[0]||(m[0]=x=>se(n)?n.value=x:null),placeholder:D.$t("service.tenor.search_gifs")},null,8,["modelValue","placeholder"]),e(k).length?(s(),g("div",Je,[i(G,{items:e(k),columns:l.columns},{default:o(({item:x})=>[x?(s(),V(H,{key:0,active:e(b)(x),onClick:I=>e(w)(x)},{default:o(()=>[(s(),V(q,{media:x,key:x.id,class:"group"},{default:o(()=>[i(ie,null,{default:o(()=>[M(S(D.$t("service.tenor.gif")),1)]),_:1})]),_:2},1032,["media"]))]),_:2},1032,["active","onClick"])):u("",!0)]),_:1},8,["items","columns"])])):u("",!0),e(C)&&!e(k).length?(s(),V(oe,{key:1,class:"mt-lg"},{default:o(()=>[M(S(D.$t("media.no_gifs_found")),1)]),_:1})):u("",!0),v("div",{ref_key:"endlessPagination",ref:d,class:"-z-10 w-full"},null,512)])):u("",!0),e(f)?u("",!0):(s(),g(J,{key:1},[i(re,{variant:"warning",closeable:!1},{default:o(()=>[M(S(D.$t("service.not_configured_service",{service:"Tenor"})),1)]),_:1}),e(P).is_admin?(s(),V(e(le),{key:0,href:D.route("mixpost.services.index"),class:"block mt-md"},{default:o(()=>[i(ae,null,{default:o(()=>[M(S(D.$t("media.click_configure")),1)]),_:1})]),_:1},8,["href"])):u("",!0)],64))],64))}};export{Ge as _,qe as a,He as b,R as u};
